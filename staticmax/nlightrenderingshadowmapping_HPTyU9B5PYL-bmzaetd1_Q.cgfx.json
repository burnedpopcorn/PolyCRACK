{"version": 1,"name": "nlightrenderingshadowmapping.cgfx","samplers":{"shadowMap":{"MinFilter": 9728,"MagFilter": 9728,"WrapS": 33071,"WrapT": 33071},"diffuse":{"MinFilter": 9729,"MagFilter": 9729,"WrapS": 33071,"WrapT": 33071}},"parameters":{"positionScale":{"type": "float","values": [1]},"objectState":{"type": "float","rows": 96,"columns": 4},"skinBones":{"type": "float","rows": 225,"columns": 4},"world":{"type": "float","rows": 4,"columns": 3},"viewTranspose":{"type": "float","rows": 3,"columns": 4},"shadowProjectionTranspose":{"type": "float","rows": 4,"columns": 4},"shadowDepth":{"type": "float","columns": 4},"pixelOffset":{"type": "float","columns": 2},"shadowMap":{"type": "sampler2D"},"uvTransform":{"type": "float","rows": 3,"columns": 2,"values": [1,0,0,1,0,0]},"diffuse":{"type": "sampler2D"}},"techniques":{"rigid":[{"parameters": ["world","viewTranspose","shadowProjectionTranspose","shadowDepth"],"semantics": ["ATTR0"],"states":{"DepthTestEnable": true,"DepthFunc": 515,"DepthMask": true,"CullFaceEnable": false,"BlendEnable": false},"programs": ["vp","fp"]}],"skinned":[{"parameters": ["skinBones","world","viewTranspose","shadowProjectionTranspose","shadowDepth"],"semantics": ["ATTR0","ATTR7","ATTR1"],"states":{"DepthTestEnable": true,"DepthFunc": 515,"DepthMask": true,"CullFaceEnable": false,"BlendEnable": false},"programs": ["vp_skinned","fp"]}],"blur":[{"parameters": ["pixelOffset","shadowMap"],"semantics": ["ATTR0","ATTR8"],"states":{"DepthTestEnable": false,"DepthMask": false,"CullFaceEnable": false,"BlendEnable": false},"programs": ["vp_blur","fp_blur"]}],"rigid_alpha":[{"parameters": ["world","viewTranspose","shadowProjectionTranspose","shadowDepth","uvTransform","diffuse"],"semantics": ["ATTR0","ATTR8"],"states":{"DepthTestEnable": true,"DepthFunc": 515,"DepthMask": true,"CullFaceEnable": false,"BlendEnable": false},"programs": ["vp_rigid_alpha","fp_alpha"]}],"rigid_instanced":[{"parameters": ["positionScale","objectState","viewTranspose","shadowProjectionTranspose","shadowDepth"],"semantics": ["ATTR0"],"states":{"DepthTestEnable": true,"DepthFunc": 515,"DepthMask": true,"CullFaceEnable": false,"BlendEnable": false},"programs": ["vp_rigid_instanced_shadowcasting","fp"]}]},"programs":{"fp":{"type": "fragment","code": "#ifdef GL_ES\n#define TZ_LOWP lowp\nprecision mediump float;\nprecision mediump int;\n#else\n#define TZ_LOWP\n#endif\nvarying vec4 tz_TexCoord[1];\nvec4 _ret_0;float _TMP0;float _r0013;float _rg0013;float _g0013;float _b0013;float _TMP16;float _x0023;float _x0025;void main()\n{_TMP0=min(1.0,tz_TexCoord[0].x);_TMP16=max(0.0,_TMP0);_x0023=_TMP16*3.19995117E+01;_r0013=floor(_x0023);_rg0013=_r0013*64.0;_x0025=_TMP16*2.04796875E+03-_rg0013;_g0013=floor(_x0025);_b0013=(_TMP16*2.11403223E+03-_r0013*6.60645142E+01)-_g0013*1.03225803;_ret_0=vec4(_r0013*3.22580636E-02,_g0013*1.58730168E-02,_b0013,1.0);gl_FragColor=_ret_0;}"},"vp_rigid_instanced_shadowcasting":{"type": "vertex","code": "#ifdef GL_ES\n#define TZ_LOWP lowp\nprecision mediump float;\nprecision mediump int;\n#else\n#define TZ_LOWP\n#endif\nvarying vec4 tz_TexCoord[1];attribute vec4 ATTR0;\nvec4 _OUTPosition1;float _OUTDepth1;int _instanceIndex0014;vec3 _TMP120016[4];uniform float positionScale;uniform vec4 objectState[96];uniform vec4 viewTranspose[3];uniform vec4 shadowProjectionTranspose[4];uniform vec4 shadowDepth;void main()\n{int _stateOffset;vec3 _position1;vec4 _worldPosition;vec4 _viewPosition;vec3 _TMP11;_instanceIndex0014=int(ATTR0.w);_stateOffset=_instanceIndex0014*3;_TMP120016[0]=vec3(objectState[_stateOffset].x,objectState[_stateOffset].y,objectState[_stateOffset].z);_TMP120016[1]=vec3(objectState[_stateOffset].w,objectState[(_stateOffset+1)].x,objectState[(_stateOffset+1)].y);_TMP120016[2]=vec3(objectState[(_stateOffset+1)].z,objectState[(_stateOffset+1)].w,objectState[(_stateOffset+2)].x);_TMP120016[3]=vec3(objectState[(_stateOffset+2)].y,objectState[(_stateOffset+2)].z,objectState[(_stateOffset+2)].w);_position1=ATTR0.xyz*positionScale;_TMP11=_position1.xxx*_TMP120016[0]+_position1.yyy*_TMP120016[1]+_position1.zzz*_TMP120016[2]+_TMP120016[3];_worldPosition=vec4(_TMP11.x,_TMP11.y,_TMP11.z,1.0);_viewPosition.x=dot(_worldPosition,viewTranspose[0]);_viewPosition.y=dot(_worldPosition,viewTranspose[1]);_viewPosition.z=dot(_worldPosition,viewTranspose[2]);_viewPosition.w=1.0;_OUTPosition1.x=dot(_viewPosition,shadowProjectionTranspose[0]);_OUTPosition1.y=dot(_viewPosition,shadowProjectionTranspose[1]);_OUTPosition1.z=dot(_viewPosition,shadowProjectionTranspose[2]);_OUTPosition1.w=dot(_viewPosition,shadowProjectionTranspose[3]);_OUTDepth1=shadowDepth.z*_viewPosition.z+shadowDepth.w;tz_TexCoord[0].x=_OUTDepth1;gl_Position=_OUTPosition1;}"},"fp_alpha":{"type": "fragment","code": "#ifdef GL_ES\n#define TZ_LOWP lowp\nprecision mediump float;\nprecision mediump int;\n#else\n#define TZ_LOWP\n#endif\nvarying vec4 tz_TexCoord[1];\nvec4 _ret_0;float _TMP0;float _r0015;float _rg0015;float _g0015;float _b0015;float _TMP18;float _x0025;float _x0027;uniform sampler2D diffuse;void main()\n{vec4 _color;_color=texture2D(diffuse,tz_TexCoord[0].xy);if(_color.w<9.96078432E-01){discard;}\n_TMP0=min(1.0,tz_TexCoord[0].z);_TMP18=max(0.0,_TMP0);_x0025=_TMP18*3.19995117E+01;_r0015=floor(_x0025);_rg0015=_r0015*64.0;_x0027=_TMP18*2.04796875E+03-_rg0015;_g0015=floor(_x0027);_b0015=(_TMP18*2.11403223E+03-_r0015*6.60645142E+01)-_g0015*1.03225803;_ret_0=vec4(_r0015*3.22580636E-02,_g0015*1.58730168E-02,_b0015,1.0);gl_FragColor=_ret_0;}"},"vp_rigid_alpha":{"type": "vertex","code": "#ifdef GL_ES\n#define TZ_LOWP lowp\nprecision mediump float;\nprecision mediump int;\n#else\n#define TZ_LOWP\n#endif\nvarying vec4 tz_TexCoord[1];attribute vec4 ATTR0;attribute vec4 ATTR8;\nvec4 _OUTPosition1;vec3 _OUTUVDepth1;uniform vec3 world[4];uniform vec4 viewTranspose[3];uniform vec4 shadowProjectionTranspose[4];uniform vec4 shadowDepth;uniform vec2 uvTransform[3];void main()\n{vec4 _worldPosition;vec4 _viewPosition;vec3 _TMP11;_TMP11=ATTR0.x*world[0]+ATTR0.y*world[1]+ATTR0.z*world[2]+world[3];_worldPosition=vec4(_TMP11.x,_TMP11.y,_TMP11.z,1.0);_viewPosition.x=dot(_worldPosition,viewTranspose[0]);_viewPosition.y=dot(_worldPosition,viewTranspose[1]);_viewPosition.z=dot(_worldPosition,viewTranspose[2]);_viewPosition.w=1.0;_OUTPosition1.x=dot(_viewPosition,shadowProjectionTranspose[0]);_OUTPosition1.y=dot(_viewPosition,shadowProjectionTranspose[1]);_OUTPosition1.z=dot(_viewPosition,shadowProjectionTranspose[2]);_OUTPosition1.w=dot(_viewPosition,shadowProjectionTranspose[3]);_OUTUVDepth1.z=shadowDepth.z*_viewPosition.z+shadowDepth.w;_OUTUVDepth1.xy=ATTR8.xx*uvTransform[0]+ATTR8.yy*uvTransform[1]+uvTransform[2];tz_TexCoord[0].xyz=_OUTUVDepth1;gl_Position=_OUTPosition1;}"},"fp_blur":{"type": "fragment","code": "#ifdef GL_ES\n#define TZ_LOWP lowp\nprecision mediump float;\nprecision mediump int;\n#else\n#define TZ_LOWP\n#endif\nvarying vec4 tz_TexCoord[1];\nvec4 _ret_0;float _TMP8;float _TMP6;float _TMP7;vec4 _TMP4;vec4 _TMP3;vec4 _TMP2;vec4 _TMP1;vec4 _TMP0;vec2 _c0021;float _TMP22;vec2 _c0027;float _TMP28;float _TMP34;vec2 _c0039;float _TMP40;vec2 _c0045;float _TMP46;float _TMP52;float _x0053;float _x0057;float _TMP62;float _x0063;float _x0067;float _TMP72;float _x0073;float _x0077;float _TMP82;float _x0083;float _x0087;float _r0091;float _rg0091;float _g0091;float _b0091;float _TMP94;float _x0101;float _x0103;uniform vec2 pixelOffset;uniform sampler2D shadowMap;void main()\n{float _accum;_c0021=tz_TexCoord[0].xy-2.0*pixelOffset;_TMP0=texture2D(shadowMap,_c0021);_TMP22=dot(_TMP0.xyz,vec3(9.68764782E-01,3.07621881E-02,4.73029679E-04));_c0027=tz_TexCoord[0].xy-pixelOffset;_TMP1=texture2D(shadowMap,_c0027);_TMP28=dot(_TMP1.xyz,vec3(9.68764782E-01,3.07621881E-02,4.73029679E-04));_TMP2=texture2D(shadowMap,tz_TexCoord[0].xy);_TMP34=dot(_TMP2.xyz,vec3(9.68764782E-01,3.07621881E-02,4.73029679E-04));_c0039=tz_TexCoord[0].xy+pixelOffset;_TMP3=texture2D(shadowMap,_c0039);_TMP40=dot(_TMP3.xyz,vec3(9.68764782E-01,3.07621881E-02,4.73029679E-04));_c0045=tz_TexCoord[0].xy+2.0*pixelOffset;_TMP4=texture2D(shadowMap,_c0045);_TMP46=dot(_TMP4.xyz,vec3(9.68764782E-01,3.07621881E-02,4.73029679E-04));_x0053=_TMP28-_TMP22;_TMP52=pow(2.71828198,_x0053);_x0057=2.00000003E-01+2.00000003E-01*_TMP52;_TMP7=log2(_x0057);_TMP6=_TMP7*6.93147182E-01;_accum=_TMP22+_TMP6;_x0063=_TMP34-_accum;_TMP62=pow(2.71828198,_x0063);_x0067=1.0+2.00000003E-01*_TMP62;_TMP7=log2(_x0067);_TMP6=_TMP7*6.93147182E-01;_accum=_accum+_TMP6;_x0073=_TMP40-_accum;_TMP72=pow(2.71828198,_x0073);_x0077=1.0+2.00000003E-01*_TMP72;_TMP7=log2(_x0077);_TMP6=_TMP7*6.93147182E-01;_accum=_accum+_TMP6;_x0083=_TMP46-_accum;_TMP82=pow(2.71828198,_x0083);_x0087=1.0+2.00000003E-01*_TMP82;_TMP7=log2(_x0087);_TMP6=_TMP7*6.93147182E-01;_accum=_accum+_TMP6;_TMP8=min(1.0,_accum);_TMP94=max(0.0,_TMP8);_x0101=_TMP94*3.19995117E+01;_r0091=floor(_x0101);_rg0091=_r0091*64.0;_x0103=_TMP94*2.04796875E+03-_rg0091;_g0091=floor(_x0103);_b0091=(_TMP94*2.11403223E+03-_r0091*6.60645142E+01)-_g0091*1.03225803;_ret_0=vec4(_r0091*3.22580636E-02,_g0091*1.58730168E-02,_b0091,1.0);gl_FragColor=_ret_0;}"},"vp_blur":{"type": "vertex","code": "#ifdef GL_ES\n#define TZ_LOWP lowp\nprecision mediump float;\nprecision mediump int;\n#else\n#define TZ_LOWP\n#endif\nvarying vec4 tz_TexCoord[1];attribute vec4 ATTR0;attribute vec4 ATTR8;\nvec4 _OUTPosition1;vec2 _OUTUV1;void main()\n{_OUTPosition1=ATTR0;_OUTUV1=ATTR8.xy;tz_TexCoord[0].xy=ATTR8.xy;gl_Position=ATTR0;}"},"vp_skinned":{"type": "vertex","code": "#ifdef GL_ES\n#define TZ_LOWP lowp\nprecision mediump float;\nprecision mediump int;\n#else\n#define TZ_LOWP\n#endif\nvarying vec4 tz_TexCoord[1];attribute vec4 ATTR0;\nstruct SkinTransform{vec4 _X;vec4 _Y;vec4 _Z;};vec4 _OUTPosition1;float _OUTDepth1;vec4 _indices0014;ivec4 _Indices0014;SkinTransform _skinWeightTransform0014;attribute vec4 ATTR7;attribute vec4 ATTR1;uniform vec4 skinBones[225];uniform vec3 world[4];uniform vec4 viewTranspose[3];uniform vec4 shadowProjectionTranspose[4];uniform vec4 shadowDepth;void main()\n{vec4 _skinTempPosition;vec3 _Position;vec4 _worldPosition;vec4 _viewPosition;vec3 _TMP11;_indices0014=ATTR7*3.0;_Indices0014=ivec4(int(_indices0014.x),int(_indices0014.y),int(_indices0014.z),int(_indices0014.w));_skinWeightTransform0014._X=ATTR1.x*skinBones[_Indices0014.x];_skinWeightTransform0014._Y=ATTR1.x*skinBones[(_Indices0014.x+1)];_skinWeightTransform0014._Z=ATTR1.x*skinBones[(_Indices0014.x+2)];_skinWeightTransform0014._X=_skinWeightTransform0014._X+ATTR1.y*skinBones[_Indices0014.y];_skinWeightTransform0014._Y=_skinWeightTransform0014._Y+ATTR1.y*skinBones[(_Indices0014.y+1)];_skinWeightTransform0014._Z=_skinWeightTransform0014._Z+ATTR1.y*skinBones[(_Indices0014.y+2)];_skinWeightTransform0014._X=_skinWeightTransform0014._X+ATTR1.z*skinBones[_Indices0014.z];_skinWeightTransform0014._Y=_skinWeightTransform0014._Y+ATTR1.z*skinBones[(_Indices0014.z+1)];_skinWeightTransform0014._Z=_skinWeightTransform0014._Z+ATTR1.z*skinBones[(_Indices0014.z+2)];_skinWeightTransform0014._X=_skinWeightTransform0014._X+ATTR1.w*skinBones[_Indices0014.w];_skinWeightTransform0014._Y=_skinWeightTransform0014._Y+ATTR1.w*skinBones[(_Indices0014.w+1)];_skinWeightTransform0014._Z=_skinWeightTransform0014._Z+ATTR1.w*skinBones[(_Indices0014.w+2)];_skinTempPosition=vec4(ATTR0.x,ATTR0.y,ATTR0.z,1.0);_Position.x=dot(_skinTempPosition,_skinWeightTransform0014._X);_Position.y=dot(_skinTempPosition,_skinWeightTransform0014._Y);_Position.z=dot(_skinTempPosition,_skinWeightTransform0014._Z);_TMP11=_Position.x*world[0]+_Position.y*world[1]+_Position.z*world[2]+world[3];_worldPosition=vec4(_TMP11.x,_TMP11.y,_TMP11.z,1.0);_viewPosition.x=dot(_worldPosition,viewTranspose[0]);_viewPosition.y=dot(_worldPosition,viewTranspose[1]);_viewPosition.z=dot(_worldPosition,viewTranspose[2]);_viewPosition.w=1.0;_OUTPosition1.x=dot(_viewPosition,shadowProjectionTranspose[0]);_OUTPosition1.y=dot(_viewPosition,shadowProjectionTranspose[1]);_OUTPosition1.z=dot(_viewPosition,shadowProjectionTranspose[2]);_OUTPosition1.w=dot(_viewPosition,shadowProjectionTranspose[3]);_OUTDepth1=shadowDepth.z*_viewPosition.z+shadowDepth.w;tz_TexCoord[0].x=_OUTDepth1;gl_Position=_OUTPosition1;}"},"vp":{"type": "vertex","code": "#ifdef GL_ES\n#define TZ_LOWP lowp\nprecision mediump float;\nprecision mediump int;\n#else\n#define TZ_LOWP\n#endif\nvarying vec4 tz_TexCoord[1];attribute vec4 ATTR0;\nvec4 _OUTPosition1;float _OUTDepth1;uniform vec3 world[4];uniform vec4 viewTranspose[3];uniform vec4 shadowProjectionTranspose[4];uniform vec4 shadowDepth;void main()\n{vec4 _worldPosition;vec4 _viewPosition;vec3 _TMP11;_TMP11=ATTR0.x*world[0]+ATTR0.y*world[1]+ATTR0.z*world[2]+world[3];_worldPosition=vec4(_TMP11.x,_TMP11.y,_TMP11.z,1.0);_viewPosition.x=dot(_worldPosition,viewTranspose[0]);_viewPosition.y=dot(_worldPosition,viewTranspose[1]);_viewPosition.z=dot(_worldPosition,viewTranspose[2]);_viewPosition.w=1.0;_OUTPosition1.x=dot(_viewPosition,shadowProjectionTranspose[0]);_OUTPosition1.y=dot(_viewPosition,shadowProjectionTranspose[1]);_OUTPosition1.z=dot(_viewPosition,shadowProjectionTranspose[2]);_OUTPosition1.w=dot(_viewPosition,shadowProjectionTranspose[3]);_OUTDepth1=shadowDepth.z*_viewPosition.z+shadowDepth.w;tz_TexCoord[0].x=_OUTDepth1;gl_Position=_OUTPosition1;}"}}}